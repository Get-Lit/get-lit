<div class="mt-5 container">
    <div>
        <h1>{{ room.name }}</h1>
        <p>{{ room.description }}</p>
        {{!-- Mostrar las im√°genes de los participantes --}}
        <div class="mt-3" id="room-participants-div">
            <h5 class="fst-italic">bookworms:</h5>
            <div>
                {{#each room.participants as |participant|}}
                    <img src="{{participant.user.image}}" alt="Participant image" referrerpolicy="no-referrer" width="30" height="30">
                {{/each}}
            </div>
        </div>
        <div class="mt-3" id="room-detail-btns">
            <button data-id="{{room.id}}" id="join-room-btn" class="btn w-25 {{#userJoinRoom participants=participants room=room}}red-btn{{else}}green-btn{{/userJoinRoom}}" type="submit">
                {{#userJoinRoom participants=participants room=room}}LEAVE ROOM{{else}}JOIN ROOM{{/userJoinRoom}}
            </button>
            {{#if admin}}
            <a class="btn w-25" href="/rooms/{{room._id}}/edit">EDIT ROOM</a>
            <form action="/rooms/{{room._id}}/delete" class="d-inline" method="post">
                <button class="btn w-25" type="submit">DELETE ROOM</button>
            </form>
            {{/if}}
        </div>
    </div>

<div class="w-75">
    {{!-- Crear un nuevo comentario --}}
    <div id="comment-div">
        <img src="{{#if currentUser}}{{currentUser.image}}{{else}}https://www.nicepng.com/png/detail/202-2022264_usuario-annimo-usuario-annimo-user-icon-png-transparent.png{{/if}}" class="comment-img" referrerpolicy="no-referrer">
        <form action="/comment/{{room._id}}" method="POST">
            <input type="text" name="content" class="form-control h-50" placeholder="Write a comment...">
            <button class="btn mt-2 w-25" type="submit">COMMENT</button>
        </form>
    </div>

    {{!-- Mostrar los comentarios que tiene la sala --}}
    <h3>Comments</h3>
        {{#each room.comments as |comment|}}    
        <div class="card mt-4">
            <div class="card-body room-comment">
                <div class="d-flex flex-direction-column w-100 h-100">
                    <img src="{{comment.user.image}}" alt="User's picture" class="comment-img">
                    <div class="w-100">
                        <h4 class="user-name">{{comment.user.name}}</h4>
                        <p>{{comment.content}}</p>
                    </div>
                        <form action="/comment/{{comment.id}}/delete" method="POST">
                            <input type="text" name="id" class="d-none" value="{{../room.id}}">
                            <button class="border-0 bg-transparent" type="submit"><i class="bi bi-x-circle"></i></button>
                        </form>
                </div>
            </div>
            <div class="bg-light">
                {{#each comment.replies as |reply|}}
                    <div class="card-body room-reply">
                        <div class="d-flex flex-direction-column w-100 h-100">
                            <img src="{{reply.user.image}}" alt="User's picture" class="reply-img" referrerpolicy="no-referrer">
                            <div class="w-100">
                                <h4 class="user-name">{{reply.user.name}}</h4>
                                <p>{{reply.content}}</p>
                            </div>
                            <form action="/comment/{{reply.id}}/delete" method="POST">
                                <input type="text" name="id" class="d-none" value="{{../../room.id}}">
                                <button class="border-0 bg-transparent" type="submit"><i class="bi bi-x-circle"></i></button>
                            </form>
                        </div>
                    </div>
                    <hr>
                {{/each}}
            </div>        
                <div class="mt-3">
                    <form class="d-flex justify-content-start align-items-center" action="/comment/{{comment.id}}/reply" method="POST">
                        <textarea class="w-100" name="content" cols="30" placeholder="Write your reply..."></textarea>
                        <input type="text" name="id" class="d-none" value="{{../room.id}}">
                        <button class="btn comment-reply-btn" type="submit">REPLY</button>
                    </form>
                </div>
            </div>
        {{/each}}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="/js/axios.js"></script>